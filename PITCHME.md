## React ã‚·ãƒªãƒ¼ã‚º

<br />

## - Suspense ã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿å–å¾— -

2020/12/16 å°æ—

---

- ã‚„ã‚ã†ã¨ã—ã¦ã„ã‚‹ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
  - Redux ç§»è¡Œ
- Suspense ã«ã¤ã„ã¦
  - Suspense ã¨ã¯
  - æ—¢å­˜ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ vs Suspense

---

@snap[north]

<h4>Before</h4>
@snapend

@snap[east]

![alt](assets/images/redux-before.png)

@snapend

---

@snap[north]

<h4>After</h4>
@snapend

@snap[east]

![alt](assets/images/redux-after.png)

@snapend

---

<h4>@color[#5289F7](ã§ã€isFetching ã‚’å®Ÿè£…ã—ã¦ã„ãŸã‚‰æ€ã£ãŸèª²é¡Œ)</h4>

- isFetching ã¨ isLoading ãŒå½¹å‰²çš„ã«ç«¶åˆã—ã¦ã„ã‚‹ï¼ˆAPI ã‚„ãã®ä»–é–¢æ•°ã®å‡¦ç†ä¸­ã‹çµ‚äº†ã—ãŸã‹ã‚’ç¤ºã™ãƒ•ãƒ©ã‚°ï¼‰
  - åŒã˜å½¹å‰²ã®å¤‰æ•°ãŒåˆ¥ã§å­˜åœ¨ã—ã¦ã„ã‚‹ã¨æ··ä¹±ã™ã‚‹ã®ç„¡ãã—ãŸã„
- true æ¡ä»¶ä¸‹ã§ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå„ Component ã§ä¼¼ã¦ã„ã‚‹
  - ã¤ã„ã§ã«ã€é‡è¤‡ã—ãŸéƒ¨åˆ†ã¯ãªã‚‹ã¹ãç„¡ãã—ãŸã„

---

@snap[north]

<h4>@color[#5289F7](isFetching ã¨ isLoading ãŒå½¹å‰²çš„ã«ç«¶åˆã—ã¦ã„ã‚‹)</h4><br />
<h5>(isFetching | isLoading) ?</h5>
@snapend

@snap[west span-45]

![drag=100 100, drop=bottom, stretch=true](assets/images/spinner.png)

@snapend

@snap[east span-50]

![alt](assets/images/isFetching-false.png)

@snapend

---

## true æ¡ä»¶ä¸‹ã§ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå„ Component ã§ä¼¼ã¦ã„ã‚‹

![alt](assets/images/isLoading-example.png)

---

## ãªã‚“ã‹ã“ã“ã‚‰ã¸ã‚“ã‚’ã‚¹ãƒƒã‚­ãƒªã•ã›ãŸã„ ğŸ¤”

---

## ã‚ã£ãŸ...ï¼

---

## ã—ã‹ã—...

![alt](assets/images/suspense-note.png)

## ãªã®ã§ã¾ã ã‚µãƒ¼ãƒ“ã‚¹ã«åˆ©ç”¨ã§ããªã„ã½ã„ã‘ã©ç´¹ä»‹ã ã‘

---

## Suspense ã¨ã¯

React 16.6 ã§ã€ã‚³ãƒ¼ãƒ‰ã®ãƒ­ãƒ¼ãƒ‰ã‚’ã€Œå¾…æ©Ÿã€ã—ã¦å®£è¨€çš„ã«ãƒ­ãƒ¼ãƒ‰ä¸­çŠ¶æ…‹ï¼ˆã‚¹ãƒ”ãƒŠãƒ¼ã®ã‚ˆã†ãªã‚‚ã®ï¼‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ <Suspense> ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## å®£è¨€å‹ã¨ã¯ã€

ã“ã“ã«ã¯ã“ã®ãƒ‡ ãƒ¼ã‚¿ãŒå…¥ã‚‹ã¹ãã€‚å¾Œã¯ãã£ã¡ã§ã‚ˆã—ãªã«ã‚„ã£ã¦ãã‚Œï¼ã€çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã­ã€‚

â‡† å‘½ä»¤å‹ï¼šæœ€çµ‚çš„ãªå‡ºåŠ›ã‚’å¾—ã‚‹ãŸã‚ã«ã€ãã®æ‰‹é †ã‚’ æ™‚ç³»åˆ—ã«æ²¿ã£ã¦æ›¸ãä¸‹ã—ã¦ã„ããƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚ã‚Šæ–¹

---

## ãƒ‡ãƒ¼ã‚¿å–å¾—ç”¨ã® Suspense

https://ja.reactjs.org/docs/optimizing-performance.html

![alt](assets/images/suspense-sample.png)

---

## ãƒ‡ãƒ¢ï¼

---

## ã‚µã‚¹ãƒšãƒ³ã‚¹ã¯ä½•ã§ãªã„ã®ã‹

- ãƒ‡ãƒ¼ã‚¿å–å¾—ã®å®Ÿè£…ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

  - REST, GraphQL ã§ã¯ãªã„

- ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’ãƒ“ãƒ¥ãƒ¼ãƒ¬ã‚¤ãƒ¤ã¨å¯†çµåˆã¯ã•ã›ãªã„ã€‚
  - ãƒ­ãƒ¼ãƒ‰ä¸­ã®çŠ¶æ…‹ã‚’ UI ã§è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è£œåŠ©ã¨ã¯ãªã‚‹ãŒã€React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–¢ä¿‚ã®ãƒ­ã‚¸ãƒƒã‚¯ã¨çµåˆã•ã›ã‚‹ã‚‚ã®ã§ã¯ãªã„ã€‚

---

## ã‚µã‚¹ãƒšãƒ³ã‚¹ã¯ä½•ãŒã§ãã‚‹ã®ã‹

- ãƒ­ãƒ¼ãƒ‰ä¸­çŠ¶æ…‹ã®è¡¨ç¤ºã‚’è¨­è¨ˆã™ã‚‹ã“ã¨ãŒå®¹æ˜“ã«ãªã‚‹

  - ãƒ‡ãƒ¼ã‚¿ãŒã©ã®ã‚ˆã†ã«å–å¾—ã•ã‚Œã‚‹ã®ã‹ã«ã¤ã„ã¦é–¢çŸ¥ã—ãªã„ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç´°ã‹ãåˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- ç«¶åˆçŠ¶æ…‹ (race condition) ã‚’é¿ã‘ã‚‹æ‰‹åŠ©ã‘ã«ãªã‚Šã¾ã™ã€‚
  - await ã‚’ä½¿ã£ã¦ã„ã¦ã™ã‚‰ã€éåŒæœŸã®ã‚³ãƒ¼ãƒ‰ã¯ã‚¨ãƒ©ãƒ¼ã‚’èµ·ã“ã—ãŒã¡ã§ã™ã€‚ã‚µã‚¹ãƒšãƒ³ã‚¹ã‚’ä½¿ã†ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãŒåŒæœŸçš„ã«èª­ã¿å‡ºã•ã‚Œã¦ã„ã‚‹ã‹ã®ã‚ˆã†ã«ã€ã¾ã‚‹ã§æ—¢ã«ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã§ã‚ã‚‹ã‹ã®ã‚ˆã†ã«æ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚ï¼ˆâ‰’ å®£è¨€å‹ï¼‰

---

## æ—¢å­˜ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ vs Suspense

![alt](assets/images/fetch-on-render-vs-suspense.png)

- ç”»é¢ä¸Šã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¬ãƒ³ãƒ€ãƒ¼ã•ã‚ŒãŸå¾Œã¾ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå§‹ã¾ã‚‰ãªã„ã®ã§ã€ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®ã“ã¨ã‚’ â€œfetch-on-renderâ€ ã¨å‘¼ã¶ã“ã¨ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯ â€œã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«â€ ã¨å‘¼ã°ã‚Œã‚‹å•é¡Œã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

- ãƒ¦ãƒ¼ã‚¶è©³ç´°æƒ…å ±ã®å–å¾—ã« 3 ç§’ã‹ã‹ã‚‹å ´åˆã€æŠ•ç¨¿ã®å–å¾—ã®é–‹å§‹ãŒ 3 ç§’å¾Œã«ãªã£ã¦ã—ã¾ã„ã¾ã™ï¼ ã“ã‚ŒãŒã€Œã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ã€ã€ã¤ã¾ã‚Šä¸¦åˆ—åŒ–å¯èƒ½ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšæ„å›³ã›ãšæ··å…¥ã—ã¦ã—ã¾ã£ãŸã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§ã™ã€‚

---

<br>

@snap[west span-45 font-size]

@size[0.75em]<b>@color[#5289F7](æ¨™æº–ã® Dispatcher)</b><br />@size[0.5em](@container)

@size[0.5em](@color[#5289F7](ç´”ç²‹ãª action ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ) ã®ã¿ dispatch ã™ã‚‹)

![alt](assets/images/mapDispatchToProps.png)

@snapend

@snap[east span-50]

@size[0.75em]<b>@color[#5289F7](Redux Thunk)</b><br />@size[0.5em](@thunk)

@size[0.5em](@color[#5289F7](å‰¯ä½œç”¨ã‚’å†…åŒ…ã—ãŸé–¢æ•°ã‚„ Promise ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã‚‚ dispatch ã™ã‚‹)

![alt](assets/images/redux-thunk-example.png)

@snapend

---?code=thunk_example.ts

---?code=reducer.ts

---?code=actionCreator.ts

---

@snap[west span-45]

![alt](assets/images/directory1.png)

@snapend

@snap[east span-50]

![alt](assets/images/directory2.png)

@snapend

---

## ã¾ã¨ã‚

- Redux Thunk
  - ç‰¹å¾´ â‘  ç´”ç²‹ãª action ã ã‘ã§ãªãã€éåŒæœŸå‡¦ç†ã‚’å«ã‚€ action creator ã‚‚ dispatch ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
  - ç‰¹å¾´ â‘¡ è¤‡æ•°ã® action ã‚’ dispatch ã™ã‚‹ã“ã¨ãŒã§ãã‚‹<br />
    â†’ ä½¿ã‚ã‚Œæ–¹ï¼šAPI ã®ã‚„ã‚Šã¨ã‚Šã‚’ Thunks ã«å›ºã‚ã‚‹ã€‚action ã‚’ç™ºè¡Œã™ã‚‹ã ã‘ã§ API ã‚’å©ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

---

@snap[west span-45]

@size[0.5em] I recommend

![alt](assets/images/ouka.png)

@snapend

@snap[east span-50]

@size[0.5em](ã‚Šã‚ã‚¯ãƒˆï¼TypeScriptã§å§‹ã‚ã‚‹ã¤ã‚‰ããªã„Reacté–‹ç™º)
@size[0.5em](å¤§å²¡ç”±ä½³)
@size[0.5em](@oukayuka)

## @snapend

---

ã”æ¸…è´ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

---
